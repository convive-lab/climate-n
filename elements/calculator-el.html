  <link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="calculator-el">
  <style type="text/css" >

        .cal-wraper{
            @apply(--layout-center);
            text-align: center;
        }
        .cal-container{
            @apply(--layout-horizontal);
            @apply(--layout-center-justified);
            @apply(--layout-wrap);
            @apply(--layout-self-center);
            @apply(--layout-flex);
            background-color: #B0BDCE;

        }
        #wrapper-card{
            @apply(--layout-horizontal);
            @apply(--layout-center-justified);
            background-color: white;
            padding: 20px;
            margin: 20px;
            @apply(--layout-wrap);
        }
        .informationstafel{
            @apply(--layout-self-center);
            @apply(--layout-center-justified);
        }
        .question-container{
            @apply(--layout-self-stretch);

        }
        .buttons{
            @apply(--layout-horizontal);
            @apply(‑‑layout-self-stretch);
        }
        .leftbtn{
          margin-right: 20px;

          border-radius: 10px;
        }
        .rightbtn{
            @apply(--layout-self-end);
            background-color: white;
            margin-left: 20px;
            border-radius: 10px;
        }
        .left-container{
            width: 500px;
            @apply(--layout-self-center);
            @apply(--layout-vertical);
            @apply(--layout-center);
            @apply(--layout-center-justified);
            @apply(‑‑self-stretch);
        }
        .informationstafel{
            text-align: center;
            font-size: 120%;
            padding:3%;
            max-width: 100%;
        }
        
		.right-container{
            @apply(--layout-self-end);
            @apply(--layout-vertical);
            @apply(--layout-center);
            @apply(--layout-center-justified);
            text-align: center;
        }
		
        .placeholder{
            width: 350px;
            height: 150px;
            background-color: #D9D9D9;
            border-radius: 4px;
            box-shadow: 1px;
            background-image: url("../data/rr.png");
        }
        .ka{
            font-size: 70%;
            float: right;
        }
        .keine-anzeige{
          margin-bottom:20px;
        }
        .co2Value{
            font-size: 150%;
            border-radius: 10px;
            margin-bottom:10px;
            text-align: center;
            @apply(--layout-center);
            @apply(--layout-center-justified);

        }
        .co2Value span{
           font-size: 180%;
        }
        paper-material{
            max-width: 100%;
        }
		
		.toast {
		margin-bottom: 100px;
		}

  </style>
  <template class="cal-wrapper" id="calculator">

    <div class="cal-container">
        <paper-material id="wrapper-card" elevation="1">
<!--             <iron-pages id="cal-wrap" selected="0">
                <selection> -->
<!--                     <div class="informationstafel">
                        <h1>CO2 Emissionsrechner</h1>
                        <wp-cards post="152"></wp-cards>
                        <div class="right">
                            <paper-button id="btnstart" on-click="_addEventListn" raised>Starten</paper-button>
                        </div>
                    </div> -->
<!--                 </selection>
                <selection> -->
                <paper-material elevation="0">
                    <div class="left-container">
                        <template is="dom-if" if={{!questionsResponse}}>
                            <iron-ajax id="menu-data" auto url="http://cn.convive.io/wp-json/wp/v2/posts/?filter[cat]=3" handle-as="json" last-response="{{questionsResponse}}" ></iron-ajax>
                        </template>
                            <iron-localstorage name="questions" value="{{questionsResponse}}"></iron-localstorage>
                            <iron-pages id="cal-question-pages" selected="0">
                                <selection>
                                    <div class="informationstafel">
                                        <h1>CO2 Emissionsrechner</h1>
                                        <wp-cards post="152"></wp-cards>
                                        <div class="right">
                                            <paper-button id="btnnext" on-click="_addEventListn" raised>Starten</paper-button>
                                        </div>
                                    </div>
                                </selection>
                                <template is="dom-repeat" items="{{questionsResponse}}">
                                    <section>
                                        <div class="question-container">
                                            <cal-question data="[[item]]" class="left wp-questions">
                                                <div class="buttons">
                                                    <div class="leftbtn"><paper-button id="btnback" raised>zurück</paper-button></div>
                                                    <div class="rightbtn"><paper-button id="btnnext"  raised>weiter</paper-button></div>

                                                </div>
                                            </cal-question>
                                        </div>
                                    </section>
                                </template>
                                <selection>
                                    <div class="informationstafel">
                                        <h1>Dankeschön</h1>
                                        <p>

                                           <!-- Das Gesamtergebnis berechnen -->

                                        </p>
                                        <paper-button id="btnback" raised>zurück</paper-button>
                                        <paper-button id="btnfin" class="right" raised>Ergebnis</paper-button>
                                    </div>
                                </selection>
                             </iron-pages>
							 <paper-toast class="toast-cal" on-click="openToast" closed duration="0">
								<wp-cards post="278"><wp-cards>
							 </paper-toast>

                    </div>   
                </paper-material>
                <paper-material elevation="0">
                    <div class="right-container">
                        <paper-card elevation="0" elevation="1" animated-shadow="false">
                            <div class="keine-anzeige">
                                <div class="placeholder"></div>
                                <span class="ka">keine Anzeige</span>
                            </div>
                            <paper-material elevation="2" class="co2Value">
                                <span>{{finalValue}}</span> <div >t  CO2 pro Jahr</div>
                            </paper-material>
                            <iron-image src="../data/fever.png" class="vertical" ></iron-image>
                        </paper-card>
                    </div>
                </paper-material>
<!--                 </selection>
            </iron-pages> -->
        </paper-material>
    </div>
        
    
    <modal-after-calc value={{finalValue}}></modal-after-calc>
    </template>

  <script>
    Polymer({
        is: 'calculator-el',
        properties: {
            position:1,
            finalValue:{type:Number,Value:0}
        },
        finalValue:0,
        answers:Object,
        questionsResponse:{
            type:Object
        },
        getValues:function(){

            var cal = document.querySelector('calculator-el');
            var quest = document.querySelectorAll('cal-question');
            for (var i=0;i<cal.questionsResponse.length;i++){
                cal.answers[i]=parseInt(quest[i].co2)
                console.log(cal.answers[i]);
            }
        },
        calFinalValue:function (){
            var cal = document.querySelector('calculator-el');
            cal.finalValue= 0;
            for (var i=0;i<cal.questionsResponse.length;i++){
                if (cal.answers[i])
                cal.finalValue+=parseInt(cal.answers[i]);
            }
            if (cal.finalValue>0)cal.finalValue= cal.finalValue/1000;
           localStorage.setItem("finalValue",cal.finalValue);
        },
        evented:false,
        _addEventListn:function () { //um die click-events der Buttons zu initiieren
            if (!this.evented){
                document.querySelector('.toast-cal').open();
                console.log('here I am ');
                var cal = document.querySelector('calculator-el');
                var next =document.querySelectorAll('#btnnext');
                var pages = document.querySelector('#cal-question-pages');
                //var radiogroups=document.querySelectorAll('paper-radio-group');
                cal.evented=true;
                // var pages2 = document.querySelector('#cal-wrap');
                // pages2.selectNext();
                pages.selectNext();
                for (i = 0; i < next.length; ++i) {
                    next[i].addEventListener('click', function(e) {
                            //if (!radiogroups[i].selected)console.log('NOnononon');
                            //check if answer else ale rt
                            pages.selectNext();
                            cal.getValues ();
                            cal.calFinalValue();

                    });
                }
                var back =document.querySelectorAll('#btnback');
                for (i = 0; i < next.length; ++i) {
                    back[i].addEventListener('click', function(e) {
                        var pages = document.querySelector('#cal-question-pages');
                            pages.selectPrevious();
                            cal.getValues ();
                            cal.calFinalValue();
                    });
                }
                var fin =document.querySelector('#btnfin');
                fin.addEventListener('click', function(e) {
                    var dia=document.querySelector('paper-dialog');
                    dia.open();
                });

            }
        },
        ready:function (){
            var cal = document.querySelector('calculator-el');

            this.finalValue=0;
            localStorage.setItem("finalValue",0);
        },
        openToast: function() {
            
            document.querySelector('.toast-cal').close();
        }


    });
	



  </script>
</dom-module>






